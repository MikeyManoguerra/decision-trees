51167d6e7bb68262cc1798fd07fa1a33
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.editAdventure = exports.editAdventureError = exports.EDIT_ADVENTURE_ERROR = exports.editAdventureSuccess = exports.EDIT_ADVENTURE_SUCCESS = exports.editAdventureRequest = exports.EDIT_ADVENTURE_REQUEST = exports.deleteAdventure = exports.getAllAdventures = exports.reRenderGraph = exports.RERENDER_GRAPH = exports.getAllAdventuresError = exports.GET_ALL_ADVENTURES_ERROR = exports.getAllAdventuresSuccess = exports.GET_ALL_ADVENTURES_SUCCESS = exports.getAllAdventuresRequest = exports.GET_ALL_ADVENTURES_REQUEST = exports.createAdventure = exports.updateAdventureById = exports.UPDATE_ADVENTURE_BY_ID = exports.getAdventureById = exports.GET_ADVENTURE_BY_ID = exports.deleteAdventureError = exports.DELETE_ADVENTURE_ERROR = exports.deleteAdventureSuccess = exports.DELETE_ADVENTURE_SUCCESS = exports.deleteAdventureRequest = exports.DELETE_ADVENTURE_REQUEST = exports.createAdventureError = exports.CREATE_ADVENTURE_ERROR = exports.getAdventureSuccess = exports.GET_ADVENTURE_SUCCESS = exports.createAdventureSuccess = exports.CREATE_ADVENTURE_SUCCESS = exports.createAdventureRequest = exports.CREATE_ADVENTURE_REQUEST = exports.toggleAnalyticsDisplay = exports.TOGGLE_ANALYTICS_DISPLAY = exports.toggleAdventureEditing = exports.TOGGLE_ADVENTURE_EDITING = exports.toggleAdventureDeleting = exports.TOGGLE_ADVENTURE_DELETING = void 0;

var _config = require("../config");

var _utils = require("../utils");

var _nodes = require("./nodes.js");

const TOGGLE_ADVENTURE_DELETING = 'TOGGLE_ADVENTURE_DELETING';
exports.TOGGLE_ADVENTURE_DELETING = TOGGLE_ADVENTURE_DELETING;

const toggleAdventureDeleting = () => ({
  type: TOGGLE_ADVENTURE_DELETING
});

exports.toggleAdventureDeleting = toggleAdventureDeleting;
const TOGGLE_ADVENTURE_EDITING = 'TOGGLE_ADVENTURE_EDITING';
exports.TOGGLE_ADVENTURE_EDITING = TOGGLE_ADVENTURE_EDITING;

const toggleAdventureEditing = () => ({
  type: TOGGLE_ADVENTURE_EDITING
});

exports.toggleAdventureEditing = toggleAdventureEditing;
const TOGGLE_ANALYTICS_DISPLAY = 'TOGGLE_ANALYTICS_DISPLAY';
exports.TOGGLE_ANALYTICS_DISPLAY = TOGGLE_ANALYTICS_DISPLAY;

const toggleAnalyticsDisplay = () => ({
  type: TOGGLE_ANALYTICS_DISPLAY
});

exports.toggleAnalyticsDisplay = toggleAnalyticsDisplay;
const CREATE_ADVENTURE_REQUEST = 'CREATE_ADVENTURE_REQUEST';
exports.CREATE_ADVENTURE_REQUEST = CREATE_ADVENTURE_REQUEST;

const createAdventureRequest = () => ({
  type: CREATE_ADVENTURE_REQUEST
});

exports.createAdventureRequest = createAdventureRequest;
const CREATE_ADVENTURE_SUCCESS = 'CREATE_ADVENTURE_SUCCESS';
exports.CREATE_ADVENTURE_SUCCESS = CREATE_ADVENTURE_SUCCESS;

const createAdventureSuccess = currentAdventure => ({
  type: CREATE_ADVENTURE_SUCCESS,
  currentAdventure
});

exports.createAdventureSuccess = createAdventureSuccess;
const GET_ADVENTURE_SUCCESS = 'GET_ADVENTURE_SUCCESS';
exports.GET_ADVENTURE_SUCCESS = GET_ADVENTURE_SUCCESS;

const getAdventureSuccess = currentAdventure => {
  return {
    type: GET_ADVENTURE_SUCCESS,
    currentAdventure
  };
};

exports.getAdventureSuccess = getAdventureSuccess;
const CREATE_ADVENTURE_ERROR = 'CREATE_ADVENTURE_ERROR';
exports.CREATE_ADVENTURE_ERROR = CREATE_ADVENTURE_ERROR;

const createAdventureError = error => ({
  type: CREATE_ADVENTURE_ERROR,
  error
});

exports.createAdventureError = createAdventureError;
const DELETE_ADVENTURE_REQUEST = 'DELETE_ADVENTURE_REQUEST';
exports.DELETE_ADVENTURE_REQUEST = DELETE_ADVENTURE_REQUEST;

const deleteAdventureRequest = () => ({
  type: DELETE_ADVENTURE_REQUEST
});

exports.deleteAdventureRequest = deleteAdventureRequest;
const DELETE_ADVENTURE_SUCCESS = 'DELETE_ADVENTURE_SUCCESS';
exports.DELETE_ADVENTURE_SUCCESS = DELETE_ADVENTURE_SUCCESS;

const deleteAdventureSuccess = adventureId => ({
  type: DELETE_ADVENTURE_SUCCESS,
  adventureId
});

exports.deleteAdventureSuccess = deleteAdventureSuccess;
const DELETE_ADVENTURE_ERROR = 'DELETE_ADVENTURE_ERROR';
exports.DELETE_ADVENTURE_ERROR = DELETE_ADVENTURE_ERROR;

const deleteAdventureError = error => ({
  type: DELETE_ADVENTURE_ERROR,
  error
});

exports.deleteAdventureError = deleteAdventureError;
const GET_ADVENTURE_BY_ID = 'GET_ADVENTURE_BY_ID';
exports.GET_ADVENTURE_BY_ID = GET_ADVENTURE_BY_ID;

const getAdventureById = adventureId => (dispatch, getState) => {
  dispatch(createAdventureRequest());
  const authToken = getState().auth.authToken;
  return fetch(`${_config.API_BASE_URL}/adventure/${adventureId}`, {
    method: 'GET',
    headers: {
      Authorization: `Bearer ${authToken}`
    }
  }).then(res => (0, _utils.normalizeResponseErrors)(res)).then(res => res.json()).then(res => {
    const headNode = getHeadNodefromAdventure(res);
    dispatch((0, _nodes.setCurrentNode)(headNode));
    dispatch(getAdventureSuccess(res));
  }).catch(error => {
    return dispatch(createAdventureError(error));
  });
};

exports.getAdventureById = getAdventureById;
const UPDATE_ADVENTURE_BY_ID = 'UPDATE_ADVENTURE_BY_ID';
exports.UPDATE_ADVENTURE_BY_ID = UPDATE_ADVENTURE_BY_ID;

const updateAdventureById = adventureId => (dispatch, getState) => {
  dispatch(createAdventureRequest());
  const authToken = getState().auth.authToken;
  return fetch(`${_config.API_BASE_URL}/adventure/${adventureId}`, {
    method: 'GET',
    headers: {
      Authorization: `Bearer ${authToken}`
    }
  }).then(res => (0, _utils.normalizeResponseErrors)(res)).then(res => res.json()).then(adventure => {
    dispatch(getAdventureSuccess(adventure));
    return adventure;
  }).catch(error => {
    return dispatch(createAdventureError(error));
  });
}; // helper function that gets the head node from newadventure object


exports.updateAdventureById = updateAdventureById;

function getHeadNodefromAdventure(adventure) {
  const headNode = adventure.head;
  return headNode;
}

const createAdventure = adventure => (dispatch, getState) => {
  dispatch(createAdventureRequest());
  const authToken = getState().auth.authToken;
  return fetch(`${_config.API_BASE_URL}/adventure/newAdventure`, {
    method: 'POST',
    headers: {
      Authorization: `Bearer ${authToken}`,
      'content-type': 'application/json'
    },
    body: JSON.stringify(adventure)
  }).then(res => (0, _utils.normalizeResponseErrors)(res)).then(res => res.json()).then(res => {
    // let headNode = getHeadNodefromAdventure(res)
    // dispatch(setCurrentNode(headNode))
    return dispatch(createAdventureSuccess(res));
  }).catch(error => {
    return dispatch(createAdventureError(error));
  });
};

exports.createAdventure = createAdventure;
const GET_ALL_ADVENTURES_REQUEST = 'GET_ALL_ADVENTURES_REQUEST';
exports.GET_ALL_ADVENTURES_REQUEST = GET_ALL_ADVENTURES_REQUEST;

const getAllAdventuresRequest = () => ({
  type: GET_ALL_ADVENTURES_REQUEST
});

exports.getAllAdventuresRequest = getAllAdventuresRequest;
const GET_ALL_ADVENTURES_SUCCESS = 'GET_ALL_ADVENTURES_SUCCESS';
exports.GET_ALL_ADVENTURES_SUCCESS = GET_ALL_ADVENTURES_SUCCESS;

const getAllAdventuresSuccess = adventures => ({
  type: GET_ALL_ADVENTURES_SUCCESS,
  adventures
});

exports.getAllAdventuresSuccess = getAllAdventuresSuccess;
const GET_ALL_ADVENTURES_ERROR = 'GET_ALL_ADVENTURES_ERROR';
exports.GET_ALL_ADVENTURES_ERROR = GET_ALL_ADVENTURES_ERROR;

const getAllAdventuresError = error => ({
  type: GET_ALL_ADVENTURES_ERROR,
  error
});

exports.getAllAdventuresError = getAllAdventuresError;
const RERENDER_GRAPH = 'RERENDER_GRAPH ';
exports.RERENDER_GRAPH = RERENDER_GRAPH;

const reRenderGraph = () => ({
  type: RERENDER_GRAPH
});

exports.reRenderGraph = reRenderGraph;

const getAllAdventures = () => (dispatch, getState) => {
  dispatch(createAdventureRequest());
  const authToken = getState().auth.authToken;
  return fetch(`${_config.API_BASE_URL}/adventure`, {
    method: 'GET',
    headers: {
      Authorization: `Bearer ${authToken}`
    }
  }).then(res => (0, _utils.normalizeResponseErrors)(res)).then(res => res.json()).then(res => dispatch(getAllAdventuresSuccess(res))).catch(error => {
    dispatch(getAllAdventuresError(error));
  });
};

exports.getAllAdventures = getAllAdventures;

const deleteAdventure = adventureId => (dispatch, getState) => {
  dispatch(deleteAdventureRequest());
  const authToken = getState().auth.authToken;
  return fetch(`${_config.API_BASE_URL}/adventure/${adventureId}/`, {
    method: 'DELETE',
    headers: {
      Authorization: `Bearer ${authToken}`,
      'content-type': 'application/json'
    }
  }).then(res => (0, _utils.normalizeResponseErrors)(res)).then(res => res.json()).then(res => {
    dispatch(deleteAdventureSuccess());
  }).catch(err => {
    dispatch(deleteAdventureError(err));
  });
};

exports.deleteAdventure = deleteAdventure;
const EDIT_ADVENTURE_REQUEST = 'EDIT_ADVENTURE_REQUEST';
exports.EDIT_ADVENTURE_REQUEST = EDIT_ADVENTURE_REQUEST;

const editAdventureRequest = () => ({
  type: EDIT_ADVENTURE_REQUEST
});

exports.editAdventureRequest = editAdventureRequest;
const EDIT_ADVENTURE_SUCCESS = 'EDIT_ADVENTURE_SUCCESS';
exports.EDIT_ADVENTURE_SUCCESS = EDIT_ADVENTURE_SUCCESS;

const editAdventureSuccess = currentAdventure => ({
  type: EDIT_ADVENTURE_SUCCESS,
  currentAdventure
});

exports.editAdventureSuccess = editAdventureSuccess;
const EDIT_ADVENTURE_ERROR = 'EDIT_ADVENTURE_ERROR';
exports.EDIT_ADVENTURE_ERROR = EDIT_ADVENTURE_ERROR;

const editAdventureError = error => ({
  type: EDIT_ADVENTURE_ERROR,
  error
});

exports.editAdventureError = editAdventureError;

const editAdventure = adventure => (dispatch, getState) => {
  dispatch(editAdventureRequest());
  let id = getState().adventure.currentAdventure.id;
  const authToken = getState().auth.authToken;
  return fetch(`${_config.API_BASE_URL}/adventure/${id}`, {
    method: 'PUT',
    headers: {
      Authorization: `Bearer ${authToken}`,
      'content-type': 'application/json'
    },
    body: JSON.stringify(adventure)
  }).then(res => (0, _utils.normalizeResponseErrors)(res)).then(res => res.json()).then(res => {
    const headNode = getHeadNodefromAdventure(res);
    dispatch((0, _nodes.setCurrentNode)(headNode));
    return dispatch(editAdventureSuccess(res));
  }).catch(error => {
    return dispatch(editAdventureError(error));
  });
};

exports.editAdventure = editAdventure;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZUFkdmVudHVyZS5qcyJdLCJuYW1lcyI6WyJUT0dHTEVfQURWRU5UVVJFX0RFTEVUSU5HIiwidG9nZ2xlQWR2ZW50dXJlRGVsZXRpbmciLCJ0eXBlIiwiVE9HR0xFX0FEVkVOVFVSRV9FRElUSU5HIiwidG9nZ2xlQWR2ZW50dXJlRWRpdGluZyIsIlRPR0dMRV9BTkFMWVRJQ1NfRElTUExBWSIsInRvZ2dsZUFuYWx5dGljc0Rpc3BsYXkiLCJDUkVBVEVfQURWRU5UVVJFX1JFUVVFU1QiLCJjcmVhdGVBZHZlbnR1cmVSZXF1ZXN0IiwiQ1JFQVRFX0FEVkVOVFVSRV9TVUNDRVNTIiwiY3JlYXRlQWR2ZW50dXJlU3VjY2VzcyIsImN1cnJlbnRBZHZlbnR1cmUiLCJHRVRfQURWRU5UVVJFX1NVQ0NFU1MiLCJnZXRBZHZlbnR1cmVTdWNjZXNzIiwiQ1JFQVRFX0FEVkVOVFVSRV9FUlJPUiIsImNyZWF0ZUFkdmVudHVyZUVycm9yIiwiZXJyb3IiLCJERUxFVEVfQURWRU5UVVJFX1JFUVVFU1QiLCJkZWxldGVBZHZlbnR1cmVSZXF1ZXN0IiwiREVMRVRFX0FEVkVOVFVSRV9TVUNDRVNTIiwiZGVsZXRlQWR2ZW50dXJlU3VjY2VzcyIsImFkdmVudHVyZUlkIiwiREVMRVRFX0FEVkVOVFVSRV9FUlJPUiIsImRlbGV0ZUFkdmVudHVyZUVycm9yIiwiR0VUX0FEVkVOVFVSRV9CWV9JRCIsImdldEFkdmVudHVyZUJ5SWQiLCJkaXNwYXRjaCIsImdldFN0YXRlIiwiYXV0aFRva2VuIiwiYXV0aCIsImZldGNoIiwiQVBJX0JBU0VfVVJMIiwibWV0aG9kIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJ0aGVuIiwicmVzIiwianNvbiIsImhlYWROb2RlIiwiZ2V0SGVhZE5vZGVmcm9tQWR2ZW50dXJlIiwiY2F0Y2giLCJVUERBVEVfQURWRU5UVVJFX0JZX0lEIiwidXBkYXRlQWR2ZW50dXJlQnlJZCIsImFkdmVudHVyZSIsImhlYWQiLCJjcmVhdGVBZHZlbnR1cmUiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIkdFVF9BTExfQURWRU5UVVJFU19SRVFVRVNUIiwiZ2V0QWxsQWR2ZW50dXJlc1JlcXVlc3QiLCJHRVRfQUxMX0FEVkVOVFVSRVNfU1VDQ0VTUyIsImdldEFsbEFkdmVudHVyZXNTdWNjZXNzIiwiYWR2ZW50dXJlcyIsIkdFVF9BTExfQURWRU5UVVJFU19FUlJPUiIsImdldEFsbEFkdmVudHVyZXNFcnJvciIsIlJFUkVOREVSX0dSQVBIIiwicmVSZW5kZXJHcmFwaCIsImdldEFsbEFkdmVudHVyZXMiLCJkZWxldGVBZHZlbnR1cmUiLCJlcnIiLCJFRElUX0FEVkVOVFVSRV9SRVFVRVNUIiwiZWRpdEFkdmVudHVyZVJlcXVlc3QiLCJFRElUX0FEVkVOVFVSRV9TVUNDRVNTIiwiZWRpdEFkdmVudHVyZVN1Y2Nlc3MiLCJFRElUX0FEVkVOVFVSRV9FUlJPUiIsImVkaXRBZHZlbnR1cmVFcnJvciIsImVkaXRBZHZlbnR1cmUiLCJpZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUNBOztBQUNBOztBQUNBOztBQUVPLE1BQU1BLHlCQUF5QixHQUFHLDJCQUFsQzs7O0FBQ0EsTUFBTUMsdUJBQXVCLEdBQUcsT0FBTztBQUM1Q0MsRUFBQUEsSUFBSSxFQUFFRjtBQURzQyxDQUFQLENBQWhDOzs7QUFJQSxNQUFNRyx3QkFBd0IsR0FBRywwQkFBakM7OztBQUNBLE1BQU1DLHNCQUFzQixHQUFHLE9BQU87QUFDM0NGLEVBQUFBLElBQUksRUFBRUM7QUFEcUMsQ0FBUCxDQUEvQjs7O0FBSUEsTUFBTUUsd0JBQXdCLEdBQUcsMEJBQWpDOzs7QUFDQSxNQUFNQyxzQkFBc0IsR0FBRyxPQUFPO0FBQzNDSixFQUFBQSxJQUFJLEVBQUVHO0FBRHFDLENBQVAsQ0FBL0I7OztBQUlBLE1BQU1FLHdCQUF3QixHQUFHLDBCQUFqQzs7O0FBQ0EsTUFBTUMsc0JBQXNCLEdBQUcsT0FBTztBQUMzQ04sRUFBQUEsSUFBSSxFQUFFSztBQURxQyxDQUFQLENBQS9COzs7QUFJQSxNQUFNRSx3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LEtBRnFDO0FBTTlDa0IsSUFBQUEsSUFBSSxFQUFFQyxJQUFJLENBQUNDLFNBQUwsQ0FBZUwsU0FBZjtBQU53QyxHQUFwQyxDQUFMLENBUUpSLElBUkksQ0FRQ0MsR0FBRyxJQUFJLG9DQUF3QkEsR0FBeEIsQ0FSUixFQVNKRCxJQVRJLENBU0NDLEdBQUcsSUFBSUEsR0FBRyxDQUFDQyxJQUFKLEVBVFIsRUFVSkYsSUFWSSxDQVVDQyxHQUFHLElBQUk7QUFDWCxVQUFNRSxRQUFRLEdBQUdDLHdCQUF3QixDQUFDSCxHQUFELENBQXpDO0FBQ0FWLElBQUFBLFFBQVEsQ0FBQywyQkFBZVksUUFBZixDQUFELENBQVI7QUFDQSxXQUFPWixRQUFRLENBQUNzQyxvQkFBb0IsQ0FBQzVCLEdBQUQsQ0FBckIsQ0FBZjtBQUNELEdBZEksRUFlSkksS0FmSSxDQWVFeEIsS0FBSyxJQUFJO0FBQ2QsV0FBT1UsUUFBUSxDQUFDd0Msa0JBQWtCLENBQUNsRCxLQUFELENBQW5CLENBQWY7QUFDRCxHQWpCSSxDQUFQO0FBa0JELENBdEJNIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgeyBBUElfQkFTRV9VUkwgfSBmcm9tICcuLi9jb25maWcnO1xuaW1wb3J0IHsgbm9ybWFsaXplUmVzcG9uc2VFcnJvcnMgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgeyBzZXRDdXJyZW50Tm9kZSB9IGZyb20gJy4vbm9kZXMuanMnXG5cbmV4cG9ydCBjb25zdCBUT0dHTEVfQURWRU5UVVJFX0RFTEVUSU5HID0gJ1RPR0dMRV9BRFZFTlRVUkVfREVMRVRJTkcnO1xuZXhwb3J0IGNvbnN0IHRvZ2dsZUFkdmVudHVyZURlbGV0aW5nID0gKCkgPT4gKHtcbiAgdHlwZTogVE9HR0xFX0FEVkVOVFVSRV9ERUxFVElOR1xufSk7XG5cbmV4cG9ydCBjb25zdCBUT0dHTEVfQURWRU5UVVJFX0VESVRJTkcgPSAnVE9HR0xFX0FEVkVOVFVSRV9FRElUSU5HJztcbmV4cG9ydCBjb25zdCB0b2dnbGVBZHZlbnR1cmVFZGl0aW5nID0gKCkgPT4gKHtcbiAgdHlwZTogVE9HR0xFX0FEVkVOVFVSRV9FRElUSU5HXG59KTtcblxuZXhwb3J0IGNvbnN0IFRPR0dMRV9BTkFMWVRJQ1NfRElTUExBWSA9ICdUT0dHTEVfQU5BTFlUSUNTX0RJU1BMQVknO1xuZXhwb3J0IGNvbnN0IHRvZ2dsZUFuYWx5dGljc0Rpc3BsYXkgPSAoKSA9PiAoe1xuICB0eXBlOiBUT0dHTEVfQU5BTFlUSUNTX0RJU1BMQVlcbn0pXG5cbmV4cG9ydCBjb25zdCBDUkVBVEVfQURWRU5UVVJFX1JFUVVFU1QgPSAnQ1JFQVRFX0FEVkVOVFVSRV9SRVFVRVNUJztcbmV4cG9ydCBjb25zdCBjcmVhdGVBZHZlbnR1cmVSZXF1ZXN0ID0gKCkgPT4gKHtcbiAgdHlwZTogQ1JFQVRFX0FEVkVOVFVSRV9SRVFVRVNULFxufSk7XG5cbmV4cG9ydCBjb25zdCBDUkVBVEVfQURWRU5UVVJFX1NVQ0NFU1MgPSAnQ1JFQVRFX0FEVkVOVFVSRV9TVUNDRVNTJztcbmV4cG9ydCBjb25zdCBjcmVhdGVBZHZlbnR1cmVTdWNjZXNzID0gKGN1cnJlbnRBZHZlbnR1cmUpID0+ICh7XG4gIHR5cGU6IENSRUFURV9BRFZFTlRVUkVfU1VDQ0VTUyxcbiAgY3VycmVudEFkdmVudHVyZVxufSk7XG5cbmV4cG9ydCBjb25zdCBHRVRfQURWRU5UVVJFX1NVQ0NFU1MgPSAnR0VUX0FEVkVOVFVSRV9TVUNDRVNTJztcbmV4cG9ydCBjb25zdCBnZXRBZHZlbnR1cmVTdWNjZXNzID0gKGN1cnJlbnRBZHZlbnR1cmUpID0+IHtcblxuICByZXR1cm4gKHtcbiAgICB0eXBlOiBHRVRfQURWRU5UVVJFX1NVQ0NFU1MsXG4gICAgY3VycmVudEFkdmVudHVyZVxuICB9KVxufTtcblxuZXhwb3J0IGNvbnN0IENSRUFURV9BRFZFTlRVUkVfRVJST1IgPSAnQ1JFQVRFX0FEVkVOVFVSRV9FUlJPUic7XG5leHBvcnQgY29uc3QgY3JlYXRlQWR2ZW50dXJlRXJyb3IgPSBlcnJvciA9PiAoe1xuICB0eXBlOiBDUkVBVEVfQURWRU5UVVJFX0VSUk9SLFxuICBlcnJvclxufSk7XG5cbmV4cG9ydCBjb25zdCBERUxFVEVfQURWRU5UVVJFX1JFUVVFU1QgPSAnREVMRVRFX0FEVkVOVFVSRV9SRVFVRVNUJztcbmV4cG9ydCBjb25zdCBkZWxldGVBZHZlbnR1cmVSZXF1ZXN0ID0gKCkgPT4gKHtcbiAgdHlwZTogREVMRVRFX0FEVkVOVFVSRV9SRVFVRVNULFxufSk7XG5cbmV4cG9ydCBjb25zdCBERUxFVEVfQURWRU5UVVJFX1NVQ0NFU1MgPSAnREVMRVRFX0FEVkVOVFVSRV9TVUNDRVNTJztcbmV4cG9ydCBjb25zdCBkZWxldGVBZHZlbnR1cmVTdWNjZXNzID0gKGFkdmVudHVyZUlkKSA9PiAoe1xuICB0eXBlOiBERUxFVEVfQURWRU5UVVJFX1NVQ0NFU1MsXG4gIGFkdmVudHVyZUlkXG59KTtcblxuZXhwb3J0IGNvbnN0IERFTEVURV9BRFZFTlRVUkVfRVJST1IgPSAnREVMRVRFX0FEVkVOVFVSRV9FUlJPUic7XG5leHBvcnQgY29uc3QgZGVsZXRlQWR2ZW50dXJlRXJyb3IgPSBlcnJvciA9PiAoe1xuICB0eXBlOiBERUxFVEVfQURWRU5UVVJFX0VSUk9SLFxuICBlcnJvclxufSk7XG5cbmV4cG9ydCBjb25zdCBHRVRfQURWRU5UVVJFX0JZX0lEID0gJ0dFVF9BRFZFTlRVUkVfQllfSUQnO1xuZXhwb3J0IGNvbnN0IGdldEFkdmVudHVyZUJ5SWQgPSBhZHZlbnR1cmVJZCA9PiAoZGlzcGF0Y2gsIGdldFN0YXRlKSA9PiB7XG4gIGRpc3BhdGNoKGNyZWF0ZUFkdmVudHVyZVJlcXVlc3QoKSk7XG4gIGNvbnN0IGF1dGhUb2tlbiA9IGdldFN0YXRlKCkuYXV0aC5hdXRoVG9rZW47XG4gIHJldHVybiBmZXRjaChgJHtBUElfQkFTRV9VUkx9L2FkdmVudHVyZS8ke2FkdmVudHVyZUlkfWAsIHtcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthdXRoVG9rZW59YFxuICAgIH0sXG4gIH0pXG4gICAgLnRoZW4ocmVzID0+IG5vcm1hbGl6ZVJlc3BvbnNlRXJyb3JzKHJlcykpXG4gICAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXG4gICAgLnRoZW4ocmVzID0+IHtcbiAgICAgIGNvbnN0IGhlYWROb2RlID0gZ2V0SGVhZE5vZGVmcm9tQWR2ZW50dXJlKHJlcyk7XG4gICAgICBkaXNwYXRjaChzZXRDdXJyZW50Tm9kZShoZWFkTm9kZSkpXG4gICAgICBkaXNwYXRjaChnZXRBZHZlbnR1cmVTdWNjZXNzKHJlcykpXG4gICAgfSlcbiAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgcmV0dXJuIGRpc3BhdGNoKGNyZWF0ZUFkdmVudHVyZUVycm9yKGVycm9yKSlcbiAgICB9KTtcbn1cblxuZXhwb3J0IGNvbnN0IFVQREFURV9BRFZFTlRVUkVfQllfSUQgPSAnVVBEQVRFX0FEVkVOVFVSRV9CWV9JRCc7XG5leHBvcnQgY29uc3QgdXBkYXRlQWR2ZW50dXJlQnlJZCA9IGFkdmVudHVyZUlkID0+IChkaXNwYXRjaCwgZ2V0U3RhdGUpID0+IHtcbiAgZGlzcGF0Y2goY3JlYXRlQWR2ZW50dXJlUmVxdWVzdCgpKTtcbiAgY29uc3QgYXV0aFRva2VuID0gZ2V0U3RhdGUoKS5hdXRoLmF1dGhUb2tlbjtcbiAgcmV0dXJuIGZldGNoKGAke0FQSV9CQVNFX1VSTH0vYWR2ZW50dXJlLyR7YWR2ZW50dXJlSWR9YCwge1xuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgaGVhZGVyczoge1xuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2F1dGhUb2tlbn1gXG4gICAgfSxcbiAgfSlcbiAgICAudGhlbihyZXMgPT4gbm9ybWFsaXplUmVzcG9uc2VFcnJvcnMocmVzKSlcbiAgICAudGhlbihyZXMgPT4gcmVzLmpzb24oKSlcbiAgICAudGhlbihhZHZlbnR1cmUgPT4ge1xuICAgICAgZGlzcGF0Y2goZ2V0QWR2ZW50dXJlU3VjY2VzcyhhZHZlbnR1cmUpKVxuICAgICAgcmV0dXJuIGFkdmVudHVyZTtcbiAgICB9KVxuICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICByZXR1cm4gZGlzcGF0Y2goY3JlYXRlQWR2ZW50dXJlRXJyb3IoZXJyb3IpKVxuICAgIH0pO1xufVxuXG4vLyBoZWxwZXIgZnVuY3Rpb24gdGhhdCBnZXRzIHRoZSBoZWFkIG5vZGUgZnJvbSBuZXdhZHZlbnR1cmUgb2JqZWN0XG5mdW5jdGlvbiBnZXRIZWFkTm9kZWZyb21BZHZlbnR1cmUoYWR2ZW50dXJlKSB7XG4gIGNvbnN0IGhlYWROb2RlID0gYWR2ZW50dXJlLmhlYWQ7XG4gIHJldHVybiBoZWFkTm9kZVxufVxuXG5leHBvcnQgY29uc3QgY3JlYXRlQWR2ZW50dXJlID0gYWR2ZW50dXJlID0+IChkaXNwYXRjaCwgZ2V0U3RhdGUpID0+IHtcbiAgZGlzcGF0Y2goY3JlYXRlQWR2ZW50dXJlUmVxdWVzdCgpKTtcbiAgY29uc3QgYXV0aFRva2VuID0gZ2V0U3RhdGUoKS5hdXRoLmF1dGhUb2tlbjtcbiAgcmV0dXJuIGZldGNoKGAke0FQSV9CQVNFX1VSTH0vYWR2ZW50dXJlL25ld0FkdmVudHVyZWAsIHtcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICBoZWFkZXJzOiB7XG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YXV0aFRva2VufWAsXG4gICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShhZHZlbnR1cmUpXG4gIH0pXG4gICAgLnRoZW4ocmVzID0+IG5vcm1hbGl6ZVJlc3BvbnNlRXJyb3JzKHJlcykpXG4gICAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXG4gICAgLnRoZW4ocmVzID0+IHtcbiAgICAgIC8vIGxldCBoZWFkTm9kZSA9IGdldEhlYWROb2RlZnJvbUFkdmVudHVyZShyZXMpXG4gICAgICAvLyBkaXNwYXRjaChzZXRDdXJyZW50Tm9kZShoZWFkTm9kZSkpXG4gICAgICByZXR1cm4gZGlzcGF0Y2goY3JlYXRlQWR2ZW50dXJlU3VjY2VzcyhyZXMpKVxuICAgIH0pXG4gICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgIHJldHVybiBkaXNwYXRjaChjcmVhdGVBZHZlbnR1cmVFcnJvcihlcnJvcikpXG4gICAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgR0VUX0FMTF9BRFZFTlRVUkVTX1JFUVVFU1QgPSAnR0VUX0FMTF9BRFZFTlRVUkVTX1JFUVVFU1QnO1xuZXhwb3J0IGNvbnN0IGdldEFsbEFkdmVudHVyZXNSZXF1ZXN0ID0gKCkgPT4gKHtcbiAgdHlwZTogR0VUX0FMTF9BRFZFTlRVUkVTX1JFUVVFU1QsXG59KTtcblxuZXhwb3J0IGNvbnN0IEdFVF9BTExfQURWRU5UVVJFU19TVUNDRVNTID0gJ0dFVF9BTExfQURWRU5UVVJFU19TVUNDRVNTJztcbmV4cG9ydCBjb25zdCBnZXRBbGxBZHZlbnR1cmVzU3VjY2VzcyA9IGFkdmVudHVyZXMgPT4gKHtcbiAgdHlwZTogR0VUX0FMTF9BRFZFTlRVUkVTX1NVQ0NFU1MsXG4gIGFkdmVudHVyZXNcbn0pO1xuXG5leHBvcnQgY29uc3QgR0VUX0FMTF9BRFZFTlRVUkVTX0VSUk9SID0gJ0dFVF9BTExfQURWRU5UVVJFU19FUlJPUic7XG5leHBvcnQgY29uc3QgZ2V0QWxsQWR2ZW50dXJlc0Vycm9yID0gZXJyb3IgPT4gKHtcbiAgdHlwZTogR0VUX0FMTF9BRFZFTlRVUkVTX0VSUk9SLFxuICBlcnJvclxufSk7XG5cbmV4cG9ydCBjb25zdCBSRVJFTkRFUl9HUkFQSCA9ICdSRVJFTkRFUl9HUkFQSCAnO1xuZXhwb3J0IGNvbnN0IHJlUmVuZGVyR3JhcGggPSAoKSA9PiAoe1xuICB0eXBlOiBSRVJFTkRFUl9HUkFQSCxcbn0pO1xuZXhwb3J0IGNvbnN0IGdldEFsbEFkdmVudHVyZXMgPSAoKSA9PiAoZGlzcGF0Y2gsIGdldFN0YXRlKSA9PiB7XG4gIGRpc3BhdGNoKGNyZWF0ZUFkdmVudHVyZVJlcXVlc3QoKSk7XG4gIGNvbnN0IGF1dGhUb2tlbiA9IGdldFN0YXRlKCkuYXV0aC5hdXRoVG9rZW47XG4gIHJldHVybiBmZXRjaChgJHtBUElfQkFTRV9VUkx9L2FkdmVudHVyZWAsIHtcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthdXRoVG9rZW59YFxuICAgIH1cbiAgfSlcbiAgICAudGhlbihyZXMgPT4gbm9ybWFsaXplUmVzcG9uc2VFcnJvcnMocmVzKSlcbiAgICAudGhlbihyZXMgPT4gcmVzLmpzb24oKSlcbiAgICAudGhlbihyZXMgPT4gZGlzcGF0Y2goZ2V0QWxsQWR2ZW50dXJlc1N1Y2Nlc3MocmVzKSkpXG4gICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgIGRpc3BhdGNoKGdldEFsbEFkdmVudHVyZXNFcnJvcihlcnJvcikpXG4gICAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgZGVsZXRlQWR2ZW50dXJlID0gYWR2ZW50dXJlSWQgPT4gKGRpc3BhdGNoLCBnZXRTdGF0ZSkgPT4ge1xuICBkaXNwYXRjaChkZWxldGVBZHZlbnR1cmVSZXF1ZXN0KCkpXG4gIGNvbnN0IGF1dGhUb2tlbiA9IGdldFN0YXRlKCkuYXV0aC5hdXRoVG9rZW47XG4gIHJldHVybiBmZXRjaChgJHtBUElfQkFTRV9VUkx9L2FkdmVudHVyZS8ke2FkdmVudHVyZUlkfS9gLCB7XG4gICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICBoZWFkZXJzOiB7XG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YXV0aFRva2VufWAsXG4gICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgfVxuICB9KVxuICAgIC50aGVuKHJlcyA9PiBub3JtYWxpemVSZXNwb25zZUVycm9ycyhyZXMpKVxuICAgIC50aGVuKHJlcyA9PiByZXMuanNvbigpKVxuICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICBkaXNwYXRjaChkZWxldGVBZHZlbnR1cmVTdWNjZXNzKCkpXG4gICAgfSlcbiAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgIGRpc3BhdGNoKGRlbGV0ZUFkdmVudHVyZUVycm9yKGVycikpXG4gICAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgRURJVF9BRFZFTlRVUkVfUkVRVUVTVCA9ICdFRElUX0FEVkVOVFVSRV9SRVFVRVNUJztcbmV4cG9ydCBjb25zdCBlZGl0QWR2ZW50dXJlUmVxdWVzdCA9ICgpID0+ICh7XG4gIHR5cGU6IEVESVRfQURWRU5UVVJFX1JFUVVFU1QsXG59KTtcblxuZXhwb3J0IGNvbnN0IEVESVRfQURWRU5UVVJFX1NVQ0NFU1MgPSAnRURJVF9BRFZFTlRVUkVfU1VDQ0VTUyc7XG5leHBvcnQgY29uc3QgZWRpdEFkdmVudHVyZVN1Y2Nlc3MgPSAoY3VycmVudEFkdmVudHVyZSkgPT4gKHtcbiAgdHlwZTogRURJVF9BRFZFTlRVUkVfU1VDQ0VTUyxcbiAgY3VycmVudEFkdmVudHVyZVxufSk7XG5cbmV4cG9ydCBjb25zdCBFRElUX0FEVkVOVFVSRV9FUlJPUiA9ICdFRElUX0FEVkVOVFVSRV9FUlJPUic7XG5leHBvcnQgY29uc3QgZWRpdEFkdmVudHVyZUVycm9yID0gZXJyb3IgPT4gKHtcbiAgdHlwZTogRURJVF9BRFZFTlRVUkVfRVJST1IsXG4gIGVycm9yXG59KTtcblxuZXhwb3J0IGNvbnN0IGVkaXRBZHZlbnR1cmUgPSBhZHZlbnR1cmUgPT4gKGRpc3BhdGNoLCBnZXRTdGF0ZSkgPT4ge1xuICBkaXNwYXRjaChlZGl0QWR2ZW50dXJlUmVxdWVzdCgpKTtcbiAgbGV0IGlkID0gZ2V0U3RhdGUoKS5hZHZlbnR1cmUuY3VycmVudEFkdmVudHVyZS5pZDtcbiAgY29uc3QgYXV0aFRva2VuID0gZ2V0U3RhdGUoKS5hdXRoLmF1dGhUb2tlbjtcbiAgcmV0dXJuIGZldGNoKGAke0FQSV9CQVNFX1VSTH0vYWR2ZW50dXJlLyR7aWR9YCwge1xuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgaGVhZGVyczoge1xuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2F1dGhUb2tlbn1gLFxuICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgIH0sXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYWR2ZW50dXJlKVxuICB9KVxuICAgIC50aGVuKHJlcyA9PiBub3JtYWxpemVSZXNwb25zZUVycm9ycyhyZXMpKVxuICAgIC50aGVuKHJlcyA9PiByZXMuanNvbigpKVxuICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICBjb25zdCBoZWFkTm9kZSA9IGdldEhlYWROb2RlZnJvbUFkdmVudHVyZShyZXMpO1xuICAgICAgZGlzcGF0Y2goc2V0Q3VycmVudE5vZGUoaGVhZE5vZGUpKVxuICAgICAgcmV0dXJuIGRpc3BhdGNoKGVkaXRBZHZlbnR1cmVTdWNjZXNzKHJlcykpXG4gICAgfSlcbiAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgcmV0dXJuIGRpc3BhdGNoKGVkaXRBZHZlbnR1cmVFcnJvcihlcnJvcikpXG4gICAgfSk7XG59O1xuXG4iXX0=